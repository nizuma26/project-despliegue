{% extends 'layout.html' %}

{% load static %}

{% block title %}
<div class="col-sm-6">
  <h4 class="text-dark">
    {{title}}
  </h4>
</div>

{% endblock title %}

{% block content %}
<div class="row mt-2">
  <div class="col-md-6 col-lg-3">
    <div class="card box-move user-widget-card bg-c-blue border-0">
      <div class="card-block text-white">
        <i class="bg-simple-c-blue card1-icon mb-2"><i class="fas fa-dolly-flatbed"></i></i>
        <h4 class="mt-3">{{movements.incorp}}</h4>
        <p style="margin-top: -10px;">Incorporaciones por Aprobar</p>
        <a href="{% url 'aprobaciones:aprob_incorporacion_list' %}" class="more-info">Mas Infor..</a>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-lg-3">
    <div class="card box-move user-widget-card bg-c-green border-0">
      <div class="card-block text-white">
        <i class="bg-simple-c-green card1-icon"><i class="fas fa-shipping-fast"></i></i>
        <h4 class="mt-3">{{movements.dist}}</h4>
        <p style="margin-top: -10px;">Distribuciones por Aprobar</p>
        <a href="{% url 'aprobaciones:aprob_distribucion_list' %}" class="more-info">Mas Infor..</a>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-lg-3">
    <div class="card box-move user-widget-card bg-c-yellow border-0">
      <div class="card-block text-white">
        <i class="bg-simple-c-yellow card1-icon"><i class="fas fa-exchange-alt"></i></i>
        <h4 class="mt-3">{{movements.tras}}</h4>
        <p style="margin-top: -10px;">Traslados por Aprobar</p>
        <a href="{% url 'aprobaciones:aprob_traslado_list' %}" class="more-info">Mas Infor..</a>
      </div>
    </div>
  </div>
  <div class="col-md-6 col-lg-3">
    <div class="card box-move user-widget-card bg-c-red border-0">
      <div class="card-block text-white">
        <i class="bg-simple-c-red card1-icon"><i class="fas fa-unlink"></i></i>
        <h4 class="mt-3">{{movements.desinc}}</h4>
        <p style="margin-top: -10px;">Desincorporaciones por Aprobar</p>
        <a href="{% url 'aprobaciones:aprob_desincorp_list' %}" class="more-info">Mas Infor..</a>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="card main_border_top input-flat">
      <div class="card-header">
        <h6>
          <i class="fas fa-dolly-flatbed"></i>
          <b> Reporte de Incorporaciones del Año {{year}} </b>
        </h6>
      </div>
      <div class="card-body" style="padding: 14px 10px 10px 10px;">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-9">
              <div id="container"></div>
            </div>
            <div class="col-md-3">
              <div class="info-box box-move bg-c-blue mb-3 text-white">
                <a class="info-box-icon text-white" href="{% url 'user:user_list' %}"><i class="far fa-user"></i></a>

                <div class="info-box-content mr-2">
                  <span class="info-box-text">Usuarios Registrados</span>
                  <span class="info-box-number">{{users.count}}</span>
                </div>
              </div>
              <div class="info-box box-move mb-3 bg-c-green text-white">
                <span class="info-box-icon"><i class="far fa-bookmark"></i></span>

                <div class="info-box-content">
                  <p class="info-box-text">Productos en Catálogo</p>
                  <span class="info-box-number">{{products.count}}</span>
                </div>
              </div>
              <div class="info-box box-move mb-3 bg-c-yellow text-white">
                <span class="info-box-icon"><i class="far fa-calendar-check"></i></span>

                <div class="info-box-content mr-2">
                  <span class="info-box-text">Solicitudes Atendidas</span>
                  <span class="info-box-number">3</span>
                </div>
              </div>
              <div class="info-box box-move mb-3 bg-c-red text-white">
                <span class="info-box-icon"><i class="far fa-calendar-times"></i></span>

                <div class="info-box-content">
                  <span class="info-box-text">Solicitudes Rechazadas</span>
                  <span class="info-box-number">0</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="card-footer py-2 border-0">
        <div class="row">
          <div class="col-sm-4 col-6">
            <div class="description-block border-right">
              <span class="description-percentage text-success"><i class="fas fa-caret-up"></i> 17%</span>
              <h5 class="description-header">172</h5>
              <span class="description-text">TOTAL DE PRODUCTOS</span>
            </div>
          </div>
          <div class="col-sm-4 col-6">
            <div class="description-block border-right">
              <span class="description-percentage text-warning"><i class="fas fa-caret-left"></i> 0%</span>
              <h5 class="description-header">$29.622.290</h5>
              <span class="description-text">SUBTOTAL</span>
            </div>
          </div>
          <!-- /.col -->
          <div class="col-sm-4 col-6">
            <div class="description-block border-right">
              <span class="description-percentage text-success"><i class="fas fa-caret-up"></i> 20%</span>
              <h5 class="description-header">$32.660.590</h5>
              <span class="description-text">TOTAL</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block javascript %}
<script src="{% static 'lib/highcharts-8.1.2/highcharts.js' %}"></script>
<script src="{% static 'lib/highcharts-8.1.2/modules/exporting.js' %}"></script>
<script src="{% static 'lib/highcharts-8.1.2/modules/export-data.js' %}"></script>
<script src="{% static 'lib/highcharts-8.1.2/modules/accessibility.js' %}"></script>
<script type="application/javascript">
  // var today = new Date();
  // var year = today.getFullYear();
  // Highcharts.setOptions({
  //   colors: ['#2097ff']
  // });
  let main_theme = main_color.getAttribute('main-color')
  let color = []
  if (main_theme === 'theme_blue') {
    color.push('#2196F3')
  }
  else if (main_theme === 'theme_green') {
    color.push('#14b38a')
  }
  else if (main_theme === 'theme_red') {
    color.push('#f35a49')
  }
  else if (main_theme === 'theme_orange') {
    color.push('#f59241')
  }
  else if (main_theme === 'theme_purple') {
    color.push('#2e82f9')
  }
  else if (main_theme === 'theme_pink') {
    color.push('#ff495a')
  }
  let graphcolumn = Highcharts.chart("container", {
    chart: {
      type: "column",
    },
    colors: color,
    title: {
      text: "Reporte de Columnas",
    },
    xAxis: {
      categories: [
        "Enero",
        "Febrero",
        "Marzo",
        "Abril",
        "Mayo",
        "Junio",
        "Julio",
        "Agosto",
        "Septiembre",
        "Octubre",
        "Noviembre",
        "Diciembre",
      ],
      crosshair: true,
    },
    yAxis: {
      min: 0,
      title: {
        text: "",
      },
    },
    tooltip: {
      headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
      pointFormat:
        '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
        '<td style="padding:0"><b>{point.y:.1f} </b></td></tr>',
      footerFormat: "</table>",
      shared: true,
      useHTML: true,
    },
    plotOptions: {
      column: {
        pointPadding: 0.2,
        borderWidth: 0,
      },
    },
  });

  function get_graph_incorp_year_month() {
    $.ajax({
      url: window.location.pathname, //window.location.pathname
      type: "POST",
      data: {
        action: "get_graph_incorp_year_month",
      },
      dataType: "json",
    })
      .done(function (data) {

        console.log(main_color.getAttribute('main-color'))

        if (!data.hasOwnProperty("error")) {
          graphcolumn.addSeries(data.data);
          return false;
        }
        message_error(data.error);
      })
      .fail(function (jqXHR, textStatus, errorThrown) {
        alert(textStatus + ": " + errorThrown);
      })
      .always(function (data) { });
  }

  $(function () {
    get_graph_incorp_year_month();
  });
</script>
{% endblock javascript %}